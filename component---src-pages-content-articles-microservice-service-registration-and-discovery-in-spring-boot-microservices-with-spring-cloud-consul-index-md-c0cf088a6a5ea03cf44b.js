"use strict";(self.webpackChunk_2much2learn_com=self.webpackChunk_2much2learn_com||[]).push([[8714,7532,4453,2679,8673,325,5841,4911,6699,6036,5824],{17961:function(e,a,n){n.r(a),n.d(a,{_frontmatter:function(){return o},default:function(){return d}});var t=n(63366),s=(n(67294),n(64983)),m=["components"],o={templateKey:"article",published:!0,displayComments:!0,showAuthorInfo:!0,showSideBar:!1,author:"narramadan",title:"Service Registration and Discovery in Spring Boot Microservices with Spring Cloud Consul",description:"A detailed step by step guide on enabling Service Registration and Discovery in Spring Boot Microservices with Spring Cloud Consul",date:"2021-01-03T15:46:37.121Z",updated:"2021-01-03T15:46:37.121Z",cover:"../../../images/blog-banners/springboot-consul-banner-1200x690.png",category:"microservice",tags:["Java","Spring Boot","Spring Cloud","Microservice","featured"],keywords:["Step by Step guide using Spring Boot","Service Registration and Discovery","Spring Cloud","Spring Boot","Spring Cloud Consul","Maven","Java","Java8","Gradle","Spring Cloud Config Consul","Consul Registration","Consul Discovery","Spring Cloud Config Multi Module project","Maven Multi Module Spring Boot Project","Gradle Multi Module Spring Boot Project","Spring Cloud Server","Step by Step guide","narra.madan","narramadan","narra.madan@outlook.com","Madan Narra","Narra Madan"]},c=function(e){return function(a){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,s.mdx)("div",a)}},p=c("GithubRepo"),r=c("ExternalLink"),l={_frontmatter:o};function d(e){var a=e.components,n=(0,t.Z)(e,m);return(0,s.mdx)("wrapper",Object.assign({},l,n,{components:a,mdxType:"MDXLayout"}),(0,s.mdx)(p,{href:"https://github.com/2much2learn/article_jan_03_srv-reg-and-discvry-in-spring-boot-microservices-with-spring-cloud-consul",mdxType:"GithubRepo"},"srv-reg-and-discvry-in-spring-boot-microservices-with-spring-cloud-consul"),(0,s.mdx)("h2",{id:"introduction"},"Introduction"),(0,s.mdx)("p",null,"In this article, we shall dig into steps on how to enable ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Service Registration and Discovery")," in ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Spring Boot")," microservices with ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Spring Cloud Consul"),"."),(0,s.mdx)("p",null,"Let’s understand the below ",(0,s.mdx)("strong",{parentName:"p"},"Problem Statement")," before we proceed further."),(0,s.mdx)("p",null,"With current infrastructure capabilities, services can be scaled up manually or automatically which makes them deployed to different dynamic locations (host & port). Configuring access to these services within application’s static configuration files cannot be a viable option. We cannot modify and deploy the consuming application with the locations to these dynamically scaled services."),(0,s.mdx)("p",null,(0,s.mdx)("strong",{parentName:"p"},"Service Registration and Discovery")," pattern comes to the rescue to overcome this problem statement. Service Registration and Discovery, is a mechanism which enables microservices to consume other microservices ",(0,s.mdx)("strong",{parentName:"p"},"without needing to know")," the exact ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"access url"),"."),(0,s.mdx)("p",null,"Enabling this capability within applications along side with applicable products & libraries, developers can focus more on the business logic to get things done and never worry about configuring access details to downstream services whenever they are scaled up/down."),(0,s.mdx)("h2",{id:"usecase"},"Usecase"),(0,s.mdx)("p",null,"We shall look into implementing a simple usecase which can help us understand the configuration needed around registering the services and have them discovered for seamless integration."),(0,s.mdx)("p",null,"Below is the use case we shall go through in this article. This includes three Spring Boot application exposing RESTFul endpoint and one of them being the root application and the other two being downstream applications. All the three services will be registered & discovered with Consul by using ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Spring Cloud Consul")),(0,s.mdx)("p",null,(0,s.mdx)("figure",{parentName:"p",className:"gatsby-resp-image-figure",style:{}},"\n    ",(0,s.mdx)("span",{parentName:"figure",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"321px"}},"\n      ",(0,s.mdx)("a",{parentName:"span",className:"gatsby-resp-image-link",href:"/static/aa8779194e96894ac7c300dae4632fb1/30592/service-consul-registration.png",style:{display:"block"},target:"_blank",rel:"noopener"},"\n    ",(0,s.mdx)("span",{parentName:"a",className:"gatsby-resp-image-background-image",style:{paddingBottom:"96.93251533742333%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAIAAAAf7rriAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACnUlEQVQ4y42U208TQRTG+yfqg0pijEFMAKMGAggVwyUCgoRboaBGATGipVETiA+FxKS22BvbLrcC5Y4FyqWwu92dvc3M0ek2EBGRyT7snNnffDvfOXNs8NegQAHAnXhR6cuz+28OzDfnwn8N21mSEgDYkpbrAgXvFztHEn01P24vpDkAINmli2BCMQAML3U6YlVdsSpHzN7DP3k5W39JmH0RTU3WBe8MLbQNxdvqg3e9P79eCgYATaO6Cg6+qtR75ZHv2rPIPRWBpp5z7HNgQWQHF/VDLuUPb/uO9X2gIAiXMEzTQFGyxlFCTNAUS5DKMlv6DyyKQAhjsxthWcZWHGOQpAthVQVZzr1LnniqZWKv45u+fmglMZMBw/gHTGlW1mSasn/1oMfLgpqpzu0YOyIAGAY9I34KIwSKDJDNx77zOxxrM+/G4/0ezb8hB9at/SWJ/f8fMAWCCT4SMCYEMIPTg0Ettp1Opo42drXoNoptWbCmEVHCFLCVc5tVyZSAqVsms6m+I+42etTQJppcQ9NJjEzILVJq5PJNKWXKC2nOlXC6Es4VYY5ZJRGDAD7IHH3ij8fmiKCaBEQxV/Pu5d6PSz2xfT9TRqZcG8hvCBXVBQqawsVINUwjl9vTawbUNFmRdUQrqidvtUQeVPpuHKop2+jaQOtUyeeV166EsyXycGLTDQRkRFSFogxBGaIiKiMCGIK7E03h4g9L3aOrg21c2fBil+1tvNXB29u5so5oeTtX7k70AQZZwQjByZNRMGDwbLiaI/e7+ernUyW9MzXd/GPbnpKs8F1/Nfu0b7q20p8n6umTfnCmPehYqw3kO3h7/3xzqffqmhBnho1vjjSGihpChd7k2Ek/OPeqcnvehlBhY7j4y8qb34b9AhKYBtO/+8v6AAAAAElFTkSuQmCC')",backgroundSize:"cover",display:"block"}}),"\n  ",(0,s.mdx)("img",{parentName:"a",className:"gatsby-resp-image-image",alt:'"Spring Boot service registry with Consul"',title:"Spring Boot service registry with Consul",src:"/static/aa8779194e96894ac7c300dae4632fb1/30592/service-consul-registration.png",srcSet:["/static/aa8779194e96894ac7c300dae4632fb1/222b7/service-consul-registration.png 163w","/static/aa8779194e96894ac7c300dae4632fb1/30592/service-consul-registration.png 321w"],sizes:"(max-width: 321px) 100vw, 321px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy",decoding:"async"}),"\n  "),"\n    "),"\n    ",(0,s.mdx)("figcaption",{parentName:"figure",className:"gatsby-resp-image-figcaption"},"Spring Boot service registry with Consul"),"\n  ")),(0,s.mdx)("p",null,"Rather than providing detailed explanation on the underlying concepts around Spring Boot (YAML configuration, Spring Profiles, Docker, Kubernetes), We shall only focus on configurations and commands to execute to have the three applications built and deployed successfully."),(0,s.mdx)("h2",{id:"technology-stack-for-implementing-the-restful-apis"},"Technology stack for implementing the Restful APIs"),(0,s.mdx)("ul",null,(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)(r,{href:"https://developers.redhat.com/download-manager/file/java-11-openjdk-11.0.7.10-1.windows.redhat.x86_64.msi",mdxType:"ExternalLink"},"Redhat OpenJDK 11")),(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)(r,{href:"https://spring.io/projects/spring-boot",mdxType:"ExternalLink"},"Spring Boot v2.4.1")),(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)(r,{href:"https://maven.apache.org/",mdxType:"ExternalLink"},"Maven v3.6.3")),(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)(r,{href:"https://gradle.org/install/",mdxType:"ExternalLink"},"Gradle v6.1.1")),(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)(r,{href:"https://hub.docker.com/editions/community/docker-ce-desktop-windows",mdxType:"ExternalLink"},"Docker Desktop for Windows")),(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)(r,{href:"https://www.consul.io/",mdxType:"ExternalLink"},"HashiCorp Consul"))),(0,s.mdx)("h2",{id:"hashicorp-consul"},"HashiCorp Consul"),(0,s.mdx)(r,{href:"https://www.consul.io/",mdxType:"ExternalLink"},"Consul")," is a distributed, highly available, datacenter-aware, service discovery and configuration system.",(0,s.mdx)("p",null,"Keeping inline to this article, Consul provides the below capabilities:"),(0,s.mdx)("ul",null,(0,s.mdx)("li",{parentName:"ul"},"Services to discover each other by storing location information (like IP addresses) in a single registry."),(0,s.mdx)("li",{parentName:"ul"},"Improve application resiliency by using Consul health checks to track the health of deployed services.")),(0,s.mdx)("p",null,"Consul provides a clean Web UI, which gives a simplified view on the registered services and their instances. It also perform periodic health checks and shows the appropriate status of the service & instance availability."),(0,s.mdx)("p",null,"Consul Web UI is accessible on ",(0,s.mdx)("strong",{parentName:"p"},"port")," ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"8500")," by default."),(0,s.mdx)("h2",{id:"spring-cloud-consul"},"Spring Cloud Consul"),(0,s.mdx)(r,{href:"https://spring.io/projects/spring-cloud-consul",mdxType:"ExternalLink"},"Spring Cloud Consul")," provides ",(0,s.mdx)(r,{href:"https://www.consul.io/",mdxType:"ExternalLink"},"Consul")," integrations for Spring Boot apps through auto configuration and binding to the Spring Environment and other Spring programming model idioms. With a few simple annotations we can quickly enable and configure the common patterns inside our application and build large distributed systems with Hashicorp’s Consul.",(0,s.mdx)("p",null,"Configuring ",(0,s.mdx)(r,{href:"https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-consul-all",mdxType:"ExternalLink"},"Spring Cloud Starter Consul All")," dependency in Spring Boot project shall provide access to the below capabilities:"),(0,s.mdx)("ul",null,(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)(r,{href:"https://docs.spring.io/spring-cloud-consul/docs/2.2.4.RELEASE/reference/html/#spring-cloud-consul-discovery",mdxType:"ExternalLink"},"Service Registration & Discovery")," - instances can be registered with the Consul agent and clients can discover the instances using Spring-managed beans."),(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)(r,{href:"https://docs.spring.io/spring-cloud-consul/docs/2.2.4.RELEASE/reference/html/#spring-cloud-consul-config",mdxType:"ExternalLink"},"Distributed Configuration")," - using the Consul Key/Value store."),(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)(r,{href:"https://docs.spring.io/spring-cloud-consul/docs/2.2.4.RELEASE/reference/html/#spring-cloud-consul-bus",mdxType:"ExternalLink"},"Control Bus")," - Distributed control events using Consul Events.")),(0,s.mdx)("p",null,"To keep inline to this article, we can add either ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"spring-cloud-starter-consul-all")," or ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"spring-cloud-starter-consul-discovery")," dependency."),(0,s.mdx)("p",null,(0,s.mdx)("code",{parentName:"p",className:"language-text"},"spring-cloud-starter-consul-discovery")," includes the below dependencies which helps in leveraging the capabilities around ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Service Registration & Discovery"),"."),(0,s.mdx)("ul",null,(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)("code",{parentName:"li",className:"language-text"},"spring-cloud-starter-netflix-ribbon")," - Ribbon for client side load-balancer via Spring Cloud Netflix"),(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)("code",{parentName:"li",className:"language-text"},"spring-cloud-starter-loadbalancer")," - A client side load-balancer provided by the Spring Cloud project"),(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)("code",{parentName:"li",className:"language-text"},"spring-cloud-starter-netflix-zuul")," - Zuul, a dynamic router and filter via Spring Cloud Netflix"),(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)("code",{parentName:"li",className:"language-text"},"spring-cloud-netflix-hystrix")," - Hystrix for Circuit Breaker resiliency capabilities.")),(0,s.mdx)("p",null,(0,s.mdx)("figure",{parentName:"p",className:"gatsby-resp-image-figure",style:{}},"\n    ",(0,s.mdx)("span",{parentName:"figure",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"650px"}},"\n      ",(0,s.mdx)("a",{parentName:"span",className:"gatsby-resp-image-link",href:"/static/866ef2881177e7c59de0981e6a56ea29/c8e86/spring-cloud-consul-flow.png",style:{display:"block"},target:"_blank",rel:"noopener"},"\n    ",(0,s.mdx)("span",{parentName:"a",className:"gatsby-resp-image-background-image",style:{paddingBottom:"57.05521472392638%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACRUlEQVQoz3WR708ScRzH/bPqWTORfvkjca0eWM16YGs+aj2w5VZLLTqOEDlTjEKSzdR0U8tDQLNgjow77s77BYP7ARyH08vgqGZy36aSmw/6PH6/9n7t/anjOZ6kyCSXZshkViikWEHOKOmkmGIzv3/uAQCAAf53ddXqPgBA2k1QOwFGW2G0MKOFs6WEqrPFClessGqFUyus/CNW0FlGC7PaCqetbu4sKzpbZxhVAMCi2N+3cRrGzRDWAGFnp/juhfTDkGhblR2f5MEloe8df/dD5rE1Xg9hJhg3922cQkW4BqMSDONmhGpHSMuLxAXu+9qBr7F/aGccZIw9ahu14+cQsn2YaodxcziLHMPQ83i9k2gdJJociUsL6d5Izv05O/wlNxLJuyN5N5p5EhCfORJNTqLFRbZCWENIHqrBSxLkJFrcmx1j9I0h4vK64lV1Ri7Fc2VcKZO5Mi7uRtcLb4+aX1JXTsAfRauHvjmd6plJ9YxQ12LqhPZLUHXmaLOizuZK376qfhg3e+jOcbbLhjeeaIYwk4u0HJo3v0/dC4q2oGQLSXBYsockeC51PyA+/afddtx88Mfl2JRn0jk5/9o/92rUb+fz8cOhqqC2WBUYf6jtJRhrdBFtCGmxYaaw7KrBaMzv8D6amEfezDoQ38AM8WBR6A0IVlToD4oQKgxM892oMGDHzzsSF51EszV+JigP1rTXlFE3d3U8edubvOXhr8e3ptUKW9CZgk6rOqfotLAbxbdmPXSnj+3ycXfG6I6o4vsLHND1P/WkRcoAAAAASUVORK5CYII=')",backgroundSize:"cover",display:"block"}}),"\n  ",(0,s.mdx)("img",{parentName:"a",className:"gatsby-resp-image-image",alt:"Spring Cloud Consul Capabilities",title:"Spring Cloud Consul Capabilities",src:"/static/866ef2881177e7c59de0981e6a56ea29/a6d36/spring-cloud-consul-flow.png",srcSet:["/static/866ef2881177e7c59de0981e6a56ea29/222b7/spring-cloud-consul-flow.png 163w","/static/866ef2881177e7c59de0981e6a56ea29/ff46a/spring-cloud-consul-flow.png 325w","/static/866ef2881177e7c59de0981e6a56ea29/a6d36/spring-cloud-consul-flow.png 650w","/static/866ef2881177e7c59de0981e6a56ea29/c8e86/spring-cloud-consul-flow.png 758w"],sizes:"(max-width: 650px) 100vw, 650px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy",decoding:"async"}),"\n  "),"\n    "),"\n    ",(0,s.mdx)("figcaption",{parentName:"figure",className:"gatsby-resp-image-figcaption"},"Spring Cloud Consul Capabilities"),"\n  ")),(0,s.mdx)("h2",{id:"bootstrapping-project-with-multi-module-spring-boot-application"},"Bootstrapping Project with Multi Module Spring Boot Application"),(0,s.mdx)("p",null,"Instead of bootstrapping the codebase for this usecase from scratch, we shall try to extend the codebase from my ",(0,s.mdx)(r,{href:"https://2much2learn.com/mavengradle-based-multi-module-spring-boot-microservices/",mdxType:"ExternalLink"},"previous article"),"."),(0,s.mdx)("p",null,"Clone the source code of the article ",(0,s.mdx)(r,{href:"https://2much2learn.com/mavengradle-based-multi-module-spring-boot-microservices/",mdxType:"ExternalLink"},"Containerizing Maven/Gradle based Multi Module Spring Boot Microservices using Docker & Kubernetes")," from ",(0,s.mdx)(r,{href:"https://github.com/2much2learn/article_dec_28_mavengradle-based-multi-module-spring-boot-microservices",mdxType:"ExternalLink"},"here"),"."),(0,s.mdx)("h2",{id:"key-changes-to-existing-codebase"},"Key changes to existing codebase"),(0,s.mdx)("p",null,"Below configuration changes are needed on existing codebase for leveraging the capabilities for ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Service Registration & Discovery")," with Consul."),(0,s.mdx)("h3",{id:"configure-mavengradle"},"Configure Maven/Gradle"),(0,s.mdx)("p",null,"Existing codebase is a multi-module project supporting both Maven and Gradle. "),(0,s.mdx)("p",null,"To distinguish artifacts from existing codebase, we shall rename the root project artifact from ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"spring-multi-module-service")," to ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"spring-multi-module-consul"),"."),(0,s.mdx)("p",null,"Add the below dependencies to root project ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"pom.xml")," & ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"build.gradle")," for enabling ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"healthcheck")," endpoint and ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"spring-cloud-consul")," capabilities."),(0,s.mdx)("h4",{id:"maven"},"Maven"),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"Root Project pom.xml"),(0,s.mdx)("div",{className:"gatsby-highlight has-highlighted-lines","data-language":"xml"},(0,s.mdx)("pre",{parentName:"div",className:"language-xml"},(0,s.mdx)("code",{parentName:"pre",className:"language-xml"},(0,s.mdx)("span",{parentName:"code",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"<"),"project...."),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},">")),"\n\n  ",(0,s.mdx)("span",{parentName:"code",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"<"),"groupId"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},">")),"com.toomuch2learn.microservices",(0,s.mdx)("span",{parentName:"code",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"</"),"groupId"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},">")),"\n",(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"\t",(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"<"),"artifactId"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},">")),"spring-multi-module-consul",(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"</"),"artifactId"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},">"))),"\t",(0,s.mdx)("span",{parentName:"code",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"<"),"version"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},">")),"0.0.1-SNAPSHOT",(0,s.mdx)("span",{parentName:"code",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"</"),"version"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},">")),"\n",(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"\t",(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"<"),"name"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},">")),"spring-multi-module-consul",(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"</"),"name"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},">"))),"\t",(0,s.mdx)("span",{parentName:"code",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"<"),"description"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},">")),"Spring multi module consul service",(0,s.mdx)("span",{parentName:"code",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"</"),"description"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},">")),"\n\n  ",(0,s.mdx)("span",{parentName:"code",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"<"),"dependencies"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},">")),"\n    ...\n    ...\n    ",(0,s.mdx)("span",{parentName:"code",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"<"),"dependency"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},">")),"\n      ",(0,s.mdx)("span",{parentName:"code",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"<"),"groupId"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},">")),"org.springframework.boot",(0,s.mdx)("span",{parentName:"code",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"</"),"groupId"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},">")),"\n",(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"      ",(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"<"),"artifactId"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},">")),"spring-boot-starter-actuator",(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"</"),"artifactId"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},">"))),"    ",(0,s.mdx)("span",{parentName:"code",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"</"),"dependency"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},">")),"\n\n    ",(0,s.mdx)("span",{parentName:"code",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"<"),"dependency"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},">")),"\n      ",(0,s.mdx)("span",{parentName:"code",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"<"),"groupId"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},">")),"org.springframework.cloud",(0,s.mdx)("span",{parentName:"code",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"</"),"groupId"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},">")),"\n",(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"      ",(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"<"),"artifactId"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},">")),"spring-cloud-starter-consul-all",(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"</"),"artifactId"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},">"))),"    ",(0,s.mdx)("span",{parentName:"code",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"</"),"dependency"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},">")),"\n  ",(0,s.mdx)("span",{parentName:"code",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"</"),"dependencies"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},">")),"\n",(0,s.mdx)("span",{parentName:"code",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token tag"},(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"</"),"project"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},">"))))),(0,s.mdx)("h4",{id:"gradle"},"Gradle"),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"Root Project settings.gradle"),(0,s.mdx)("div",{className:"gatsby-highlight has-highlighted-lines","data-language":"groovy"},(0,s.mdx)("pre",{parentName:"div",className:"language-groovy"},(0,s.mdx)("code",{parentName:"pre",className:"language-groovy"},(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"rootProject",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"."),"name ",(0,s.mdx)("span",{parentName:"span",className:"token operator"},"=")," ",(0,s.mdx)("span",{parentName:"span",className:"token string"},"'spring-multi-module-consul'")),"\ninclude ",(0,s.mdx)("span",{parentName:"code",className:"token string"},"'service-a'"),"\ninclude ",(0,s.mdx)("span",{parentName:"code",className:"token string"},"'service-b'"),"\ninclude ",(0,s.mdx)("span",{parentName:"code",className:"token string"},"'service-c'")))),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"Root Project build.gradle"),(0,s.mdx)("div",{className:"gatsby-highlight has-highlighted-lines","data-language":"groovy"},(0,s.mdx)("pre",{parentName:"div",className:"language-groovy"},(0,s.mdx)("code",{parentName:"pre",className:"language-groovy"},(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"...."),"\n",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"...."),"\nsubprojects ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"{"),"\n\n\t",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"...."),"\n\t",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"...."),"\n\t\n\tdependencies ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"{"),"\n",(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"\t\timplementation ",(0,s.mdx)("span",{parentName:"span",className:"token string"},"'org.springframework.boot:spring-boot-starter-actuator'")),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"\t\timplementation ",(0,s.mdx)("span",{parentName:"span",className:"token string"},"'org.springframework.boot:spring-cloud-starter-consul-all'")),"\t\t",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"...."),"\n\t\t",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"...."),"\n\t",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"}"),"\n",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"...."),"\n",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"....")))),(0,s.mdx)("h3",{id:"annotating-springbootapplication-class"},"Annotating SpringBootApplication Class"),(0,s.mdx)("p",null,"We need to annotate our SpringBoot main class with ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"@EnableDiscoveryClient")," alongside with ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"@SpringBootApplication"),"."),(0,s.mdx)("p",null,(0,s.mdx)("code",{parentName:"p",className:"language-text"},"@EnableDiscoveryClient")," annotation is part of ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Spring Cloud Commons")," project which looks for implementations of the ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"DiscoveryClient")," available on the classpath. "),(0,s.mdx)("p",null,"Adding ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"@EnableDiscoveryClient")," annotation is ",(0,s.mdx)("strong",{parentName:"p"},"no longer required")," as the appropriate implementation is identified by the one available in classpath. But adding this will make us aware on the capabilities that are configured in our Spring Boot application in a glance."),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"ServiceAApplication.java"),(0,s.mdx)("div",{className:"gatsby-highlight has-highlighted-lines","data-language":"java"},(0,s.mdx)("pre",{parentName:"div",className:"language-java"},(0,s.mdx)("code",{parentName:"pre",className:"language-java"},(0,s.mdx)("span",{parentName:"code",className:"token keyword"},"package")," ",(0,s.mdx)("span",{parentName:"code",className:"token namespace"},"com",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"."),"toomuch2learn",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"."),"microservices",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"."),"servicea"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",(0,s.mdx)("span",{parentName:"code",className:"token keyword"},"import")," ",(0,s.mdx)("span",{parentName:"code",className:"token namespace"},"org",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"."),"springframework",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"."),"boot",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},".")),(0,s.mdx)("span",{parentName:"code",className:"token class-name"},"SpringApplication"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},";"),"\n",(0,s.mdx)("span",{parentName:"code",className:"token keyword"},"import")," ",(0,s.mdx)("span",{parentName:"code",className:"token namespace"},"org",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"."),"springframework",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"."),"boot",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"."),"autoconfigure",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},".")),(0,s.mdx)("span",{parentName:"code",className:"token class-name"},"SpringBootApplication"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},";"),"\n",(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},(0,s.mdx)("span",{parentName:"span",className:"token keyword"},"import")," ",(0,s.mdx)("span",{parentName:"span",className:"token namespace"},"org",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"."),"springframework",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"."),"cloud",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"."),"client",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"."),"discovery",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},".")),(0,s.mdx)("span",{parentName:"span",className:"token class-name"},"EnableDiscoveryClient"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},";")),(0,s.mdx)("span",{parentName:"code",className:"token keyword"},"import")," ",(0,s.mdx)("span",{parentName:"code",className:"token namespace"},"org",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"."),"springframework",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"."),"cloud",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"."),"openfeign",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},".")),(0,s.mdx)("span",{parentName:"code",className:"token class-name"},"EnableFeignClients"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},";"),"\n\n",(0,s.mdx)("span",{parentName:"code",className:"token annotation punctuation"},"@SpringBootApplication"),"\n",(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},(0,s.mdx)("span",{parentName:"span",className:"token annotation punctuation"},"@EnableDiscoveryClient")),(0,s.mdx)("span",{parentName:"code",className:"token annotation punctuation"},"@EnableFeignClients"),"\n",(0,s.mdx)("span",{parentName:"code",className:"token keyword"},"public")," ",(0,s.mdx)("span",{parentName:"code",className:"token keyword"},"class")," ",(0,s.mdx)("span",{parentName:"code",className:"token class-name"},"ServiceAApplication")," ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"{"),"\n\n\t",(0,s.mdx)("span",{parentName:"code",className:"token keyword"},"public")," ",(0,s.mdx)("span",{parentName:"code",className:"token keyword"},"static")," ",(0,s.mdx)("span",{parentName:"code",className:"token keyword"},"void")," ",(0,s.mdx)("span",{parentName:"code",className:"token function"},"main"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"("),(0,s.mdx)("span",{parentName:"code",className:"token class-name"},"String"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"["),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"]")," args",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},")")," ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"{"),"\n\t\t",(0,s.mdx)("span",{parentName:"code",className:"token class-name"},"SpringApplication"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"."),(0,s.mdx)("span",{parentName:"code",className:"token function"},"run"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"("),(0,s.mdx)("span",{parentName:"code",className:"token class-name"},"ServiceAApplication"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"."),(0,s.mdx)("span",{parentName:"code",className:"token keyword"},"class"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},",")," args",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},")"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},";"),"\n\t",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"}"),"\n\n",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"}")))),(0,s.mdx)("h3",{id:"configuring-application-properties"},"Configuring Application properties"),(0,s.mdx)("p",null,"Application configurations are maintained in ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"application.yaml")," with multiple profiles available for us to choose the right profile based on the environment the application is deployed to."),(0,s.mdx)("p",null,"Below is the application configuration for ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Service A"),", which is configured with ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"service-b")," & ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"service-c")," url and ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"spring.cloud.consul")," properties."),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"Service A - application.yaml"),(0,s.mdx)("div",{className:"gatsby-highlight has-highlighted-lines","data-language":"yaml"},(0,s.mdx)("pre",{parentName:"div",className:"language-yaml"},(0,s.mdx)("code",{parentName:"pre",className:"language-yaml"},(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"spring"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n  ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"application"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"name"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," service",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"a\n  ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"profiles"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"active"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," ",(0,s.mdx)("span",{parentName:"code",className:"token string"},'"dev"'),"\n",(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"  ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"cloud"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"    ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"consul"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"      ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"host"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")," 127.0.0.1"),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"      ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"discovery"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":"),"        "),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"        ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"instanceId"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")," ",(0,s.mdx)("span",{parentName:"span",className:"token string"},'"${spring.application.name}-${server.port}-${spring.cloud.client.ip-address}"')),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"        ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"prefer-ip-address"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")," ",(0,s.mdx)("span",{parentName:"span",className:"token boolean important"},"true")),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"        ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"health-check-critical-timeout"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")," ",(0,s.mdx)("span",{parentName:"span",className:"token string"},'"1m"')),"\n",(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"server"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"  ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"port")," ",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")," ",(0,s.mdx)("span",{parentName:"span",className:"token number"},"8080")),"\n",(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"serviceb"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"  ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"url"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")," http",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":"),"//service",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"-"),"b"),"\n",(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"servicec"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"  ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"url"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")," http",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":"),"//service",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"-"),"c"),"\n",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"---"),"\n\n",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"spring"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n  ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"profiles"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," dev\n\n",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"server"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n  ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"port")," ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," ",(0,s.mdx)("span",{parentName:"code",className:"token number"},"8081"),"\n\n",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"---"),"\n\n",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"spring"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n  ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"profiles"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," prod"))),(0,s.mdx)("p",null,"Below are few points to note:"),(0,s.mdx)("ul",null,(0,s.mdx)("li",{parentName:"ul"},"The default port configured for the spring boot application is ",(0,s.mdx)("code",{parentName:"li",className:"language-text"},"8080")," but is overridden to ",(0,s.mdx)("code",{parentName:"li",className:"language-text"},"8081")," for ",(0,s.mdx)("code",{parentName:"li",className:"language-text"},"dev")," profile."),(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)("code",{parentName:"li",className:"language-text"},"spring.cloud.consul")," properties are configured at global level to remain the same for both ",(0,s.mdx)("code",{parentName:"li",className:"language-text"},"dev")," & ",(0,s.mdx)("code",{parentName:"li",className:"language-text"},"prod")," profile."),(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)("code",{parentName:"li",className:"language-text"},"spring.cloud.consul.host")," property is pointing to ",(0,s.mdx)("code",{parentName:"li",className:"language-text"},"127.0.0.1")," and port to ",(0,s.mdx)("code",{parentName:"li",className:"language-text"},"8500")," by default. This can be overridden by passing the property as environment variable based on how the services are provisioned & deployed."),(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)("code",{parentName:"li",className:"language-text"},"serviceb.url")," & ",(0,s.mdx)("code",{parentName:"li",className:"language-text"},"servicec.url")," is configured with ",(0,s.mdx)("strong",{parentName:"li"},"Service B")," & ",(0,s.mdx)("strong",{parentName:"li"},"Service C")," ",(0,s.mdx)("code",{parentName:"li",className:"language-text"},"spring.application.name"),". These properties will be expanded during runtime and leveraged by different ",(0,s.mdx)("code",{parentName:"li",className:"language-text"},"Spring Cloud")," capabilities - Service Discovery, Load Balancing & Circuit Breaker.")),(0,s.mdx)("p",null,"Application properties remain the same for ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Service B")," & ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Service C")," apart from ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"spring.application.name")," and ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"server.port")),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"Service B - application.yaml"),(0,s.mdx)("div",{className:"gatsby-highlight has-highlighted-lines","data-language":"yaml"},(0,s.mdx)("pre",{parentName:"div",className:"language-yaml"},(0,s.mdx)("code",{parentName:"pre",className:"language-yaml"},(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"spring"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n  ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"application"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"name"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," service",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"b\n  ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"profiles"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"active"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," ",(0,s.mdx)("span",{parentName:"code",className:"token string"},'"dev"'),"\n",(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"  ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"cloud"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"    ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"consul"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"      ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"discovery"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"        ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"instanceId"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")," ",(0,s.mdx)("span",{parentName:"span",className:"token string"},'"${spring.application.name}-${server.port}-${spring.cloud.client.ip-address}"')),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"        ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"prefer-ip-address"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")," ",(0,s.mdx)("span",{parentName:"span",className:"token boolean important"},"true")),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"        ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"health-check-critical-timeout"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")," ",(0,s.mdx)("span",{parentName:"span",className:"token string"},'"1m"')),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"}),(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"server"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n  ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"port")," ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," ",(0,s.mdx)("span",{parentName:"code",className:"token number"},"8080"),"\n\n",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"---"),"\n\n",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"spring"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n  ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"profiles"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," dev\n\n",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"server"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n  ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"port")," ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," ",(0,s.mdx)("span",{parentName:"code",className:"token number"},"8082"),"\n\n",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"---"),"\n\n",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"spring"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n  ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"profiles"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," prod\n  "))),(0,s.mdx)("p",null,"Below are few ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Spring Cloud Consul")," configuration properties that we configured above. Refer to the ",(0,s.mdx)(r,{href:"https://cloud.spring.io/spring-cloud-consul/reference/html/appendix.html#common-application-properties",mdxType:"ExternalLink"},"documentation")," for the complete list of available configuration properties."),(0,s.mdx)("table",null,(0,s.mdx)("thead",{parentName:"table"},(0,s.mdx)("tr",{parentName:"thead"},(0,s.mdx)("th",{parentName:"tr",align:null},"Name"),(0,s.mdx)("th",{parentName:"tr",align:null},"Default"),(0,s.mdx)("th",{parentName:"tr",align:null},"Description"))),(0,s.mdx)("tbody",{parentName:"table"},(0,s.mdx)("tr",{parentName:"tbody"},(0,s.mdx)("td",{parentName:"tr",align:null},"spring.cloud.consul.host"),(0,s.mdx)("td",{parentName:"tr",align:null},"localhost"),(0,s.mdx)("td",{parentName:"tr",align:null},"Consul agent hostname. Defaults to ‘localhost’.")),(0,s.mdx)("tr",{parentName:"tbody"},(0,s.mdx)("td",{parentName:"tr",align:null},"spring.cloud.consul.discovery.instanceId"),(0,s.mdx)("td",{parentName:"tr",align:null}),(0,s.mdx)("td",{parentName:"tr",align:null},"Unique Id that identifies the instance in Consul UI.")),(0,s.mdx)("tr",{parentName:"tbody"},(0,s.mdx)("td",{parentName:"tr",align:null},"spring.cloud.consul.discovery.prefer-ip-address"),(0,s.mdx)("td",{parentName:"tr",align:null},"false"),(0,s.mdx)("td",{parentName:"tr",align:null},"Use ip address rather than hostname during registration.")),(0,s.mdx)("tr",{parentName:"tbody"},(0,s.mdx)("td",{parentName:"tr",align:null},"spring.cloud.consul.discovery.health-check-critical-timeout"),(0,s.mdx)("td",{parentName:"tr",align:null}),(0,s.mdx)("td",{parentName:"tr",align:null},"Timeout to deregister services critical for longer than timeout (e.g. 30m).")))),(0,s.mdx)("h3",{id:"building-docker-images"},"Building Docker Images"),(0,s.mdx)("p",null,"Run below commands from the root project to build multi-module project artifacts and create docker images for individual modules."),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"Maven-Build and create docker images for all modules from parent"),(0,s.mdx)("div",{className:"gatsby-highlight","data-language":"bash"},(0,s.mdx)("pre",{parentName:"div",className:"language-bash"},(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"$ mvn clean package spring-boot:build-image"))),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"Gradle-Build and create docker images for all project from parent"),(0,s.mdx)("div",{className:"gatsby-highlight","data-language":"bash"},(0,s.mdx)("pre",{parentName:"div",className:"language-bash"},(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"$ gradle clean build bootBuildImage"))),(0,s.mdx)("p",null,"Executing ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"docker images | grep spring-multi-module-consul")," should list the below three docker images."),(0,s.mdx)("p",null,(0,s.mdx)("figure",{parentName:"p",className:"gatsby-resp-image-figure",style:{}},"\n    ",(0,s.mdx)("span",{parentName:"figure",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"650px"}},"\n      ",(0,s.mdx)("a",{parentName:"span",className:"gatsby-resp-image-link",href:"/static/71edabaa5c5aec583742a69c18cf4dc0/321ea/docker-images.png",style:{display:"block"},target:"_blank",rel:"noopener"},"\n    ",(0,s.mdx)("span",{parentName:"a",className:"gatsby-resp-image-background-image",style:{paddingBottom:"9.202453987730062%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAc0lEQVQI1wXBwRECIQwAQNrw7ftGDUqChJBA0Bk/14pjH37sxae1nbvh9929npGr9cE+1W9qxn1IH1JrTniK58MlHQsjUYS4JAQkAFiQIGxb+Lz3me8+i0+zLmoskvtoCUH0ypWalnV9+NREMLz5VKI4XP6raB9Vg1rUtAAAAABJRU5ErkJggg==')",backgroundSize:"cover",display:"block"}}),"\n  ",(0,s.mdx)("img",{parentName:"a",className:"gatsby-resp-image-image",alt:"Docker images created from Maven/Gradle Spring Boot build image command",title:"Docker images created from Maven/Gradle Spring Boot build image command",src:"/static/71edabaa5c5aec583742a69c18cf4dc0/a6d36/docker-images.png",srcSet:["/static/71edabaa5c5aec583742a69c18cf4dc0/222b7/docker-images.png 163w","/static/71edabaa5c5aec583742a69c18cf4dc0/ff46a/docker-images.png 325w","/static/71edabaa5c5aec583742a69c18cf4dc0/a6d36/docker-images.png 650w","/static/71edabaa5c5aec583742a69c18cf4dc0/321ea/docker-images.png 786w"],sizes:"(max-width: 650px) 100vw, 650px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy",decoding:"async"}),"\n  "),"\n    "),"\n    ",(0,s.mdx)("figcaption",{parentName:"figure",className:"gatsby-resp-image-figcaption"},"Docker images created from Maven/Gradle Spring Boot build image command"),"\n  ")),(0,s.mdx)("h3",{id:"pushing-docker-images-to-docker-hub"},"Pushing docker images to Docker Hub"),(0,s.mdx)("p",null,"Follow the below steps to tag the images and push them to Docker Hub."),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"Ensure to login to Docker"),(0,s.mdx)("div",{className:"gatsby-highlight","data-language":"bash"},(0,s.mdx)("pre",{parentName:"div",className:"language-bash"},(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"$ ",(0,s.mdx)("span",{parentName:"code",className:"token function"},"docker")," login"))),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"Tag docker image before pushing to docker hub if image name is not tagged with docker hub username"),(0,s.mdx)("div",{className:"gatsby-highlight","data-language":"bash"},(0,s.mdx)("pre",{parentName:"div",className:"language-bash"},(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"$ ",(0,s.mdx)("span",{parentName:"code",className:"token function"},"docker")," tab ",(0,s.mdx)("span",{parentName:"code",className:"token operator"},"<"),"IMAGE_ID",(0,s.mdx)("span",{parentName:"code",className:"token operator"},">")," ",(0,s.mdx)("span",{parentName:"code",className:"token operator"},"<"),"Docker_Username",(0,s.mdx)("span",{parentName:"code",className:"token operator"},">"),"/",(0,s.mdx)("span",{parentName:"code",className:"token operator"},"<"),"IMAGE_NAME",(0,s.mdx)("span",{parentName:"code",className:"token operator"},">"),"\n\n$ ",(0,s.mdx)("span",{parentName:"code",className:"token function"},"docker")," tag ffc5ec760103 ",(0,s.mdx)("span",{parentName:"code",className:"token variable"},"$DOCKER_USER_NAME"),"$/springboot-servicea"))),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"Push to docker hub"),(0,s.mdx)("div",{className:"gatsby-highlight","data-language":"bash"},(0,s.mdx)("pre",{parentName:"div",className:"language-bash"},(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"$ ",(0,s.mdx)("span",{parentName:"code",className:"token function"},"docker")," push ",(0,s.mdx)("span",{parentName:"code",className:"token operator"},"<"),"Docker_Username",(0,s.mdx)("span",{parentName:"code",className:"token operator"},">"),"/",(0,s.mdx)("span",{parentName:"code",className:"token operator"},"<"),"IMAGE_NAME",(0,s.mdx)("span",{parentName:"code",className:"token operator"},">"),"\n\n$ ",(0,s.mdx)("span",{parentName:"code",className:"token function"},"docker")," push ",(0,s.mdx)("span",{parentName:"code",className:"token variable"},"$DOCKER_USER_NAME"),"$/spring-multi-module-service-service-a"))),(0,s.mdx)("h2",{id:"bootstrapping-consul-server"},"Bootstrapping Consul Server"),(0,s.mdx)("p",null,"Consul is a complex system that has many different moving parts which constitutes Data Centers, Servers & Agents participating in a ",(0,s.mdx)(r,{href:"https://www.consul.io/docs/internals/gossip",mdxType:"ExternalLink"},"gossip protocol"),"."),(0,s.mdx)("p",null,"Consul provides native installation procedure to install the server on host directly. But the easiest way to try out consul is to work with ",(0,s.mdx)(r,{href:"https://hub.docker.com/_/consul",mdxType:"ExternalLink"},"Consul Docker Image"),"."),(0,s.mdx)("p",null,"Run the below ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"docker run")," command to kick start Consul server."),(0,s.mdx)("div",{className:"gatsby-highlight","data-language":"bash:run%20consul%20docker%20image"},(0,s.mdx)("pre",{parentName:"div",className:"language-bash:run%20consul%20docker%20image"},(0,s.mdx)("code",{parentName:"pre",className:"language-bash:run%20consul%20docker%20image"},"$ docker run -d --name consul-server -p 8500:8500 -e CONSUL_BIND_INTERFACE=eth0 consul"))),(0,s.mdx)("div",{className:"gatsby-highlight","data-language":"bash:check%20startup%20logs"},(0,s.mdx)("pre",{parentName:"div",className:"language-bash:check%20startup%20logs"},(0,s.mdx)("code",{parentName:"pre",className:"language-bash:check%20startup%20logs"},"$ $ docker logs consul-server\n\n==> Found address '172.17.0.2' for interface 'eth0', setting bind option...\n==> Starting Consul agent...\n           Version: '1.9.1'\n           Node ID: '597f4fef-fdcb-734a-37f1-14faefab6615'\n         Node name: '962e56017069'\n        Datacenter: 'dc1' (Segment: '<all>')\n            Server: true (Bootstrap: false)\n       Client Addr: [0.0.0.0] (HTTP: 8500, HTTPS: -1, gRPC: 8502, DNS: 8600)\n      Cluster Addr: 172.17.0.2 (LAN: 8301, WAN: 8302)\n           Encrypt: Gossip: false, TLS-Outgoing: false, TLS-Incoming: false, Auto-Encrypt-TLS: false"))),(0,s.mdx)("p",null,"Access ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"http://127.0.0.1:8500")," to open up Consul UI. Observe there is only one service registered which is the consul server itself."),(0,s.mdx)("p",null,(0,s.mdx)("figure",{parentName:"p",className:"gatsby-resp-image-figure",style:{}},"\n    ",(0,s.mdx)("span",{parentName:"figure",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"650px"}},"\n      ",(0,s.mdx)("a",{parentName:"span",className:"gatsby-resp-image-link",href:"/static/8fec2c65ae9c418f3d7bd9a105ca4df9/99272/consul-ui-blank.png",style:{display:"block"},target:"_blank",rel:"noopener"},"\n    ",(0,s.mdx)("span",{parentName:"a",className:"gatsby-resp-image-background-image",style:{paddingBottom:"41.104294478527606%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA70lEQVQY05XOzUrDQBDA8X0KsaAHL30Fn0ML6skX8Im0kIsXiw8gLfVukSAFT2rxg5LdTWKK0cludnZmJa2IeNH8+R1mmMuIwfbRafcw2tiLNvf7nV6/0ztZ3/3T8dpOtHUgHoaT+Gx4MxhNz8ezi6un0fXLOP6Xy1iU8H47u3uU8/v5syHC0CIRiNFhBcY7T57Q4Tf/Azp0NS4Wb0misvS1LMHVKEII1YeRUqZZbmtnrc2WVcZ6T4h+BaDK8zyRUqtUKW1sTcQCySvQRVEAAHMgYmamJv5l2er8tQoKpMpUaW2MCS1r3mYKRNQMLfsEzdujx8HKnzEAAAAASUVORK5CYII=')",backgroundSize:"cover",display:"block"}}),"\n  ",(0,s.mdx)("img",{parentName:"a",className:"gatsby-resp-image-image",alt:"No other services registered yet",title:"No other services registered yet !!!",src:"/static/8fec2c65ae9c418f3d7bd9a105ca4df9/a6d36/consul-ui-blank.png",srcSet:["/static/8fec2c65ae9c418f3d7bd9a105ca4df9/222b7/consul-ui-blank.png 163w","/static/8fec2c65ae9c418f3d7bd9a105ca4df9/ff46a/consul-ui-blank.png 325w","/static/8fec2c65ae9c418f3d7bd9a105ca4df9/a6d36/consul-ui-blank.png 650w","/static/8fec2c65ae9c418f3d7bd9a105ca4df9/99272/consul-ui-blank.png 669w"],sizes:"(max-width: 650px) 100vw, 650px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy",decoding:"async"}),"\n  "),"\n    "),"\n    ",(0,s.mdx)("figcaption",{parentName:"figure",className:"gatsby-resp-image-figcaption"},"No other services registered yet !!!"),"\n  ")),(0,s.mdx)("p",null,"Run the below commands to start Spring Boot services and observe they are registered and displayed in Consul UI successfully."),(0,s.mdx)("p",null,"Start the services by running the individual fat jars. This will use ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"dev")," profile as configured in application.yaml"),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"Start fat jars"),(0,s.mdx)("div",{className:"gatsby-highlight","data-language":"bash"},(0,s.mdx)("pre",{parentName:"div",className:"language-bash"},(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"$ mvn clean package\n\n$ java -jar service-a",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"\\"),"target",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"\\"),"service-a-0.0.1-SNAPSHOT.jar\n$ java -jar service-b",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"\\"),"target",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"\\"),"service-b-0.0.1-SNAPSHOT.jar\n$ java -jar service-c",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"\\"),"target",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"\\"),"service-c-0.0.1-SNAPSHOT.jar"))),(0,s.mdx)("p",null,"Access Consul UI after a minute to observe three new services registered as below."),(0,s.mdx)("p",null,(0,s.mdx)("figure",{parentName:"p",className:"gatsby-resp-image-figure",style:{}},"\n    ",(0,s.mdx)("span",{parentName:"figure",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"650px"}},"\n      ",(0,s.mdx)("a",{parentName:"span",className:"gatsby-resp-image-link",href:"/static/702820a6059cab03767e782698e726d1/99272/consul-ui-services-java.png",style:{display:"block"},target:"_blank",rel:"noopener"},"\n    ",(0,s.mdx)("span",{parentName:"a",className:"gatsby-resp-image-background-image",style:{paddingBottom:"71.16564417177914%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABV0lEQVQoz52Ry0rDQBSG5ym04krfwfdQdKFP4CNZqODOleJeNLouaFssSkGRpkmTmdyay2QmczkjaYtgvUD8+DaHgfn5z0HnO8dn20edjf3O5kG7tdde/9PW0pO13dOtQ/R23R1cWE+X1vDqfnzzMLF6zl3/N+tXqzdZePuIZlnaHfSfX0fD0UuYpTln0oAwIH8SzBdQxbk9tqeuF5IwJIT4JMC1xMffJAGJvCkOSJSlRVUJBAB5Wriu62NMaUkp9Wtwlhecs0/SNMPzH8IwCoKQ8UprQAqUT3Ecx0VeABgAkFJKIbU283Gp1iClEjVSCKE1AAACA0EWej5mjM2LLHtBXXDFVZAGHZdJWZaMMaUUNAFpA27iOY6bJIlSyjQBaaNnLKWUcs7/kaztxPE8P45jIUSzZDCQ84IxrhcbbJSsjH6Px7Y9iaKocWdjjBSqqqrFeRolfwC7+AH+0XjDUAAAAABJRU5ErkJggg==')",backgroundSize:"cover",display:"block"}}),"\n  ",(0,s.mdx)("img",{parentName:"a",className:"gatsby-resp-image-image",alt:"Three new Spring Boot services registered with Consul",title:"Three new Spring Boot services registered with Consul",src:"/static/702820a6059cab03767e782698e726d1/a6d36/consul-ui-services-java.png",srcSet:["/static/702820a6059cab03767e782698e726d1/222b7/consul-ui-services-java.png 163w","/static/702820a6059cab03767e782698e726d1/ff46a/consul-ui-services-java.png 325w","/static/702820a6059cab03767e782698e726d1/a6d36/consul-ui-services-java.png 650w","/static/702820a6059cab03767e782698e726d1/99272/consul-ui-services-java.png 669w"],sizes:"(max-width: 650px) 100vw, 650px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy",decoding:"async"}),"\n  "),"\n    "),"\n    ",(0,s.mdx)("figcaption",{parentName:"figure",className:"gatsby-resp-image-figcaption"},"Three new Spring Boot services registered with Consul"),"\n  ")),(0,s.mdx)("p",null,"Access ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Service A")," ",(0,s.mdx)("strong",{parentName:"p"},"greeting")," endpoint to see if API is working as expected by accessing downstream ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Service B")," and ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Service C")," APIs."),(0,s.mdx)("p",null,(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Service Discovery")," should working seamlessly by itself as we haven’t configured downstream APIs access urls."),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"Access service-a greeting endpoint"),(0,s.mdx)("div",{className:"gatsby-highlight","data-language":"bash"},(0,s.mdx)("pre",{parentName:"div",className:"language-bash"},(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"$ ",(0,s.mdx)("span",{parentName:"code",className:"token function"},"curl")," http://localhost:8081/greeting\n\n",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"{"),(0,s.mdx)("span",{parentName:"code",className:"token string"},'"id"'),":1,",(0,s.mdx)("span",{parentName:"code",className:"token string"},'"content"'),(0,s.mdx)("span",{parentName:"code",className:"token builtin class-name"},":"),(0,s.mdx)("span",{parentName:"code",className:"token string"},'"Service-A - Hello, World! - Service-B - Hello, World! - 1 - Service-C - Hello, World! - 1"'),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"}")))),(0,s.mdx)("h2",{id:"deploying-with-docker-compose"},"Deploying with Docker Compose"),(0,s.mdx)("p",null,"Instead of running docker images individually, the complete stack with Consul server can be brought ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"up")," / ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"down")," with ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"docker-compose"),"."),(0,s.mdx)("p",null,"Below is ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"docker-compose.yaml")," with ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Consul")," and all the ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"spring-boot")," services configured individually."),(0,s.mdx)("p",null,"Keep an eye on the below specifics: "),(0,s.mdx)("ul",null,(0,s.mdx)("li",{parentName:"ul"},(0,s.mdx)("code",{parentName:"li",className:"language-text"},"consul-server")," is linked to all ",(0,s.mdx)("code",{parentName:"li",className:"language-text"},"spring-boot")," services."),(0,s.mdx)("li",{parentName:"ul"},"Additional instances for ",(0,s.mdx)("code",{parentName:"li",className:"language-text"},"service-b")," & ",(0,s.mdx)("code",{parentName:"li",className:"language-text"},"service-c")," are configured to verify how ",(0,s.mdx)("code",{parentName:"li",className:"language-text"},"Load Balancing")," works all by itself without any specific configuration needed from ",(0,s.mdx)("code",{parentName:"li",className:"language-text"},"service-a")," to access these downstream APIs.")),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"docker-compose.yaml"),(0,s.mdx)("div",{className:"gatsby-highlight has-highlighted-lines","data-language":"yaml"},(0,s.mdx)("pre",{parentName:"div",className:"language-yaml"},(0,s.mdx)("code",{parentName:"pre",className:"language-yaml"},(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"version"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," ",(0,s.mdx)("span",{parentName:"code",className:"token string"},"'3.9'"),"\n\n",(0,s.mdx)("span",{parentName:"code",className:"token comment"},"# Define services"),"\n",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"services"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n\n  ",(0,s.mdx)("span",{parentName:"code",className:"token comment"},"# Service A"),"\n",(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"  ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"consul-server"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"    ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"image"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")," consul"),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"    ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"ports"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"      ",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"-")," 8500",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":"),(0,s.mdx)("span",{parentName:"span",className:"token number"},"8500")),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"    ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"restart"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")," always"),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"    ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"environment"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"      ",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"-")," ",(0,s.mdx)("span",{parentName:"span",className:"token string"},'"CONSUL_BIND_INTERFACE=eth0"')),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"    ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"networks"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"      ",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"-")," backend"),"\n  ",(0,s.mdx)("span",{parentName:"code",className:"token comment"},"# Service A"),"\n  ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"service-a"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"image"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," $DOCKER_USER_NAME$/spring",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"multi",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"module",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"consul",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"service",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"a\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"restart"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," always\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"ports"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n      ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-")," 8080",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),(0,s.mdx)("span",{parentName:"code",className:"token number"},"8080"),"\n",(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"    ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"links"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"      ",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"-")," consul",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"-"),"server"),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"    ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"environment"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"      ",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"-")," spring.profiles.active=prod"),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"      ",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"-")," spring.cloud.consul.host=consul",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"-"),"server"),"    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"networks"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n      ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-")," backend\n\n  ",(0,s.mdx)("span",{parentName:"code",className:"token comment"},"# Service B - 1"),"\n",(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"  ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"service-b-1"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")),"    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"image"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," $DOCKER_USER_NAME$/spring",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"multi",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"module",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"consul",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"service",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"b\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"restart"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," always\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"links"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n      ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-")," consul",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"server\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"environment"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n      ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-")," spring.profiles.active=prod\n      ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-")," spring.cloud.consul.host=consul",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"server\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"networks"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," \n      ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-")," backend\n\n  ",(0,s.mdx)("span",{parentName:"code",className:"token comment"},"# Service B - 2"),"\n",(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"  ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"service-b-2"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")),"    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"image"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," $DOCKER_USER_NAME$/spring",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"multi",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"module",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"consul",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"service",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"b\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"restart"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," always\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"links"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n      ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-")," consul",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"server\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"environment"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n      ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-")," spring.profiles.active=prod\n      ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-")," spring.cloud.consul.host=consul",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"server\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"networks"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," \n      ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-")," backend\n\n  ",(0,s.mdx)("span",{parentName:"code",className:"token comment"},"# Service C - 1"),"\n",(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"  ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"service-c-1"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")),"    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"image"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," $DOCKER_USER_NAME$/spring",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"multi",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"module",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"consul",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"service",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"c\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"restart"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," always\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"links"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n      ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-")," consul",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"server\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"environment"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n      ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-")," spring.profiles.active=prod\n      ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-")," spring.cloud.consul.host=consul",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"server\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"networks"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n      ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-")," backend\n\n  ",(0,s.mdx)("span",{parentName:"code",className:"token comment"},"# Service C - 2"),"\n",(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"  ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"service-c-2"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")),"    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"image"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," $DOCKER_USER_NAME$/spring",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"multi",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"module",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"consul",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"service",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"c\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"restart"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," always\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"links"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n      ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-")," consul",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"server\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"environment"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n      ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-")," spring.profiles.active=prod\n      ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-")," spring.cloud.consul.host=consul",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"server\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"networks"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," \n      ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-")," backend\n\n",(0,s.mdx)("span",{parentName:"code",className:"token comment"},"# Networks to be created to facilitate communication between containers"),"\n",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"networks"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n  backend",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")))),(0,s.mdx)("p",null,"Run the below ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"docker-compose")," commands to get the stack ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"up"),", ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"stop"),", ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"start"),", ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"down")," appropriately. "),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"Validate docker-compose file and configuration"),(0,s.mdx)("div",{className:"gatsby-highlight","data-language":"bash"},(0,s.mdx)("pre",{parentName:"div",className:"language-bash"},(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"$ ",(0,s.mdx)("span",{parentName:"code",className:"token function"},"docker-compose")," config"))),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"Builds, (re)creates, starts, and attaches to containers for a service."),(0,s.mdx)("div",{className:"gatsby-highlight","data-language":"bash"},(0,s.mdx)("pre",{parentName:"div",className:"language-bash"},(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"$ ",(0,s.mdx)("span",{parentName:"code",className:"token function"},"docker-compose")," up -d"))),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"Lists containers"),(0,s.mdx)("div",{className:"gatsby-highlight","data-language":"bash"},(0,s.mdx)("pre",{parentName:"div",className:"language-bash"},(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"$ ",(0,s.mdx)("span",{parentName:"code",className:"token function"},"docker-compose")," ",(0,s.mdx)("span",{parentName:"code",className:"token function"},"ps")))),(0,s.mdx)("p",null,"Access Consul UI after a minute to observe three services registered and ",(0,s.mdx)("strong",{parentName:"p"},"2 instances")," for ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"service-a")," and ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"service-b")," as below."),(0,s.mdx)("p",null,(0,s.mdx)("figure",{parentName:"p",className:"gatsby-resp-image-figure",style:{}},"\n    ",(0,s.mdx)("span",{parentName:"figure",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"523px"}},"\n      ",(0,s.mdx)("a",{parentName:"span",className:"gatsby-resp-image-link",href:"/static/7efcbbcefcf4272fe5d3676bd9a0efc1/3e286/consul-ui-services-compose.png",style:{display:"block"},target:"_blank",rel:"noopener"},"\n    ",(0,s.mdx)("span",{parentName:"a",className:"gatsby-resp-image-background-image",style:{paddingBottom:"74.23312883435584%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA7CAAAOwgEVKEqAAAABxUlEQVQ4y52Sy27TUBBA/ROoXcGn8ActLVXZ9AdY8QFBCNiwZQmoXwArGqEKERGVBhKad6B5NbGdEqWJ4zotqZVc2/celAcg2NTJSGc3c++cmdFe337A7q17vLixzsuVjRmrmzNWNnm1Gp7dm9to8fvPie08Y3/rMe+3n7K/9YTonYdT3m1E2FuP8HYtwl4IoncfobXMFrlcnnqjQblSwTBNxsJDCIE9hECxUGh926aQL6LrBtVanaauM7xyGQ6vsH9KhKdQSiHl9UzytACfilvn8uKSnmX995+aMkkMizYpcQYO3XYHp99HCjF7Rqml0IJuj/OvCdx8kVGhxChfwKvWkAqklKFU/1EefyuR7qRp2TZmt0vPdfHzRfA8lglNNpp4sc8MDhKMU2lUJodIJJfW1kS1Si32Bid+QD/2cYpIHU1nKZlrT7Z8HX+Us1lqbhvdsji1bWzfw6+foJzBfNGLHaIWGC38D4eM4p/wD79AIolIHv3tTKpwHf5WHpfL5DJROpksp8kUVrGEX/qOHFzM5ijlYjP0sjm6Zy3ahon1o83IdQlOGsjO2ZLK5w7ecQ3RNPB1k0A38Bo6Mgjm9yVDM+nwF9xgSX76oMRiAAAAAElFTkSuQmCC')",backgroundSize:"cover",display:"block"}}),"\n  ",(0,s.mdx)("img",{parentName:"a",className:"gatsby-resp-image-image",alt:"Spring Boot services registered with Consul",title:"Spring Boot services registered with Consul",src:"/static/7efcbbcefcf4272fe5d3676bd9a0efc1/3e286/consul-ui-services-compose.png",srcSet:["/static/7efcbbcefcf4272fe5d3676bd9a0efc1/222b7/consul-ui-services-compose.png 163w","/static/7efcbbcefcf4272fe5d3676bd9a0efc1/ff46a/consul-ui-services-compose.png 325w","/static/7efcbbcefcf4272fe5d3676bd9a0efc1/3e286/consul-ui-services-compose.png 523w"],sizes:"(max-width: 523px) 100vw, 523px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy",decoding:"async"}),"\n  "),"\n    "),"\n    ",(0,s.mdx)("figcaption",{parentName:"figure",className:"gatsby-resp-image-figcaption"},"Spring Boot services registered with Consul"),"\n  ")),(0,s.mdx)("p",null,(0,s.mdx)("figure",{parentName:"p",className:"gatsby-resp-image-figure",style:{}},"\n    ",(0,s.mdx)("span",{parentName:"figure",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"650px"}},"\n      ",(0,s.mdx)("a",{parentName:"span",className:"gatsby-resp-image-link",href:"/static/ff4b9fb709d33a678160d6928e019551/6e9ba/consul-ui-services-instances-compose.png",style:{display:"block"},target:"_blank",rel:"noopener"},"\n    ",(0,s.mdx)("span",{parentName:"a",className:"gatsby-resp-image-background-image",style:{paddingBottom:"54.601226993865026%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABfElEQVQoz5WQ2WrbUBRF9f8f1VJIW4KS5qWUEMeWbdmSrOFKuvMZ7lGrCEoKfclmvy72kC0iECLGKCktIstHlBV5/uPT51/fvu/zx3i9fgzujsfy+fl2ODT7fVAqiSBSSok5/RfYyvGbsqjdeKi90j7G2dgQ4jhN3gdjLBH/a2LmlJKIeO8BIPMu6FlbY/FNAIhIAAiIEeC9EckY13WDGudpMoiUJRHrnNYGiUXWVkmEkzCn90Yk7/2o5q7rh0GFiCJLxsRDr263dlSjN9bOOlpPgBvztykCugCzdcZ56wOvMZJNbj5Vp6FX56I43ee7r3cv91/suSROSLRNBQDi5JubKUtX1fpchqpa344Ms9XeR6vNfK3Gy0VV56AmIN72M6cIiJxC19vjyZWlKY6xaVZ4dNPred807WG3K56eXh7z158Prq6RCNdoRqQVJnZtq8uLaxpdXmLbrjAJQ6JFFlkWpnWoB4dI2+dbMgASp6BGUze27XTdhH74A/8G09N4ZjOXYasAAAAASUVORK5CYII=')",backgroundSize:"cover",display:"block"}}),"\n  ",(0,s.mdx)("img",{parentName:"a",className:"gatsby-resp-image-image",alt:"Listing all instances registered under a service",title:"Listing all instances registered under a service",src:"/static/ff4b9fb709d33a678160d6928e019551/a6d36/consul-ui-services-instances-compose.png",srcSet:["/static/ff4b9fb709d33a678160d6928e019551/222b7/consul-ui-services-instances-compose.png 163w","/static/ff4b9fb709d33a678160d6928e019551/ff46a/consul-ui-services-instances-compose.png 325w","/static/ff4b9fb709d33a678160d6928e019551/a6d36/consul-ui-services-instances-compose.png 650w","/static/ff4b9fb709d33a678160d6928e019551/6e9ba/consul-ui-services-instances-compose.png 731w"],sizes:"(max-width: 650px) 100vw, 650px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy",decoding:"async"}),"\n  "),"\n    "),"\n    ",(0,s.mdx)("figcaption",{parentName:"figure",className:"gatsby-resp-image-figcaption"},"Listing all instances registered under a service"),"\n  ")),(0,s.mdx)("p",null,"Access ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Service A")," ",(0,s.mdx)("strong",{parentName:"p"},"greeting")," endpoint multiple times to see downstream APIs are accessed via round-robin fashion with internal load balancer."),(0,s.mdx)("p",null,(0,s.mdx)("figure",{parentName:"p",className:"gatsby-resp-image-figure",style:{}},"\n    ",(0,s.mdx)("span",{parentName:"figure",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"650px"}},"\n      ",(0,s.mdx)("a",{parentName:"span",className:"gatsby-resp-image-link",href:"/static/554f9aee6ab1c7cb38d86859d84e2813/1cfc2/consul-ui-services-access-compose.png",style:{display:"block"},target:"_blank",rel:"noopener"},"\n    ",(0,s.mdx)("span",{parentName:"a",className:"gatsby-resp-image-background-image",style:{paddingBottom:"36.809815950920246%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABQUlEQVQY0y2P25KjIBRF8zEzicjhonY0AspFFBAx1vT//0tXqudlva29at+6AfUCDxIGBa+JjhPtBdD2j9R/rX/M7m78wy7I2NrYellAqkpNSKpqFPfbIOg4MaU7qdvJfSnTybltnsgHVC4aMz7eLJ80RpwzOwoPkaSdhQCLr2/9CK+JCM3lzJVtpOFi5m1f2RWlQtaEU6Exky2QGPm+c7cQv1K3gHXo1gsQM5GGS8OU/VBo1g2V+y0f+LhofrOU6J6bcjbrRkNg60b8pyzgNYHQ9DOhmdJsnGnzvLutOi6Iuc4nyYWkRPZMj8K2DUKgW4BfmQjNlGmUaWbXzq6TmvOvu4/V9Q35XZ//oFykFHKe7Lp4SiRlkhIsHn0+P8e6l//Zj7gXuHk+tKvWCNYjH2HZwDm8eLpuVBtsLdEGTzP6AZH8YDXFUc6vAAAAAElFTkSuQmCC')",backgroundSize:"cover",display:"block"}}),"\n  ",(0,s.mdx)("img",{parentName:"a",className:"gatsby-resp-image-image",alt:"Downstream APIs are accessed using spring-cloud-loadbalancer",title:"Downstream APIs are accessed using spring-cloud-loadbalancer",src:"/static/554f9aee6ab1c7cb38d86859d84e2813/a6d36/consul-ui-services-access-compose.png",srcSet:["/static/554f9aee6ab1c7cb38d86859d84e2813/222b7/consul-ui-services-access-compose.png 163w","/static/554f9aee6ab1c7cb38d86859d84e2813/ff46a/consul-ui-services-access-compose.png 325w","/static/554f9aee6ab1c7cb38d86859d84e2813/a6d36/consul-ui-services-access-compose.png 650w","/static/554f9aee6ab1c7cb38d86859d84e2813/1cfc2/consul-ui-services-access-compose.png 900w"],sizes:"(max-width: 650px) 100vw, 650px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy",decoding:"async"}),"\n  "),"\n    "),"\n    ",(0,s.mdx)("figcaption",{parentName:"figure",className:"gatsby-resp-image-figcaption"},"Downstream APIs are accessed using spring-cloud-loadbalancer"),"\n  ")),(0,s.mdx)("p",null,"Proceed to stop the services or bring down the provisioned stack by running below commands."),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"Stops running containers without removing them"),(0,s.mdx)("div",{className:"gatsby-highlight","data-language":"bash"},(0,s.mdx)("pre",{parentName:"div",className:"language-bash"},(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"$ ",(0,s.mdx)("span",{parentName:"code",className:"token function"},"docker-compose")," stop"))),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"Starts existing containers for a service"),(0,s.mdx)("div",{className:"gatsby-highlight","data-language":"bash"},(0,s.mdx)("pre",{parentName:"div",className:"language-bash"},(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"$ ",(0,s.mdx)("span",{parentName:"code",className:"token function"},"docker-compose")," start"))),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"Stops containers and removes containers, networks, volumes, and images created by - up"),(0,s.mdx)("div",{className:"gatsby-highlight","data-language":"bash"},(0,s.mdx)("pre",{parentName:"div",className:"language-bash"},(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"$ ",(0,s.mdx)("span",{parentName:"code",className:"token function"},"docker-compose")," down"))),(0,s.mdx)("h2",{id:"deploying-with-kubernetes"},"Deploying with Kubernetes"),(0,s.mdx)("p",null,"Docker Desktop is the easiest way to run Kubernetes on your windows machine. It gives ua a fully certified Kubernetes cluster and manages all the components for us."),(0,s.mdx)("p",null,"Install ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Docker Desktop")," and ensure to ",(0,s.mdx)("strong",{parentName:"p"},"enable")," kubernetes from settings window."),(0,s.mdx)("p",null,(0,s.mdx)("figure",{parentName:"p",className:"gatsby-resp-image-figure",style:{}},"\n    ",(0,s.mdx)("span",{parentName:"figure",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"650px"}},"\n      ",(0,s.mdx)("a",{parentName:"span",className:"gatsby-resp-image-link",href:"/static/14a53e933acb23fd2df6146cbf2df02b/798d4/docker_desktop_kubernetes.png",style:{display:"block"},target:"_blank",rel:"noopener"},"\n    ",(0,s.mdx)("span",{parentName:"a",className:"gatsby-resp-image-background-image",style:{paddingBottom:"48.46625766871166%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7CAAAOwgEVKEqAAAABeUlEQVQoz32RO24UQRCG5yQIASERKSk34UiAIxICTsA5MCCRgCzh3Zntnn5PP6bHsoMPTduyZ82K4FN1V9fjr+ru2QfL/3j63vLmc+D1p8CLM9d8T95ZXn30vP0y8fJM8nwT353vC+d9odktfeFbPzf7fSj8GB7F3fm/7vNRXndTZ67vuNlwVTJLTs1en4i5vy/HeZ3zkVFZwpRIuZLyTM4VKUd2+wPaOHJZmv+YesI30xnjUMpgraeU2liDe5UIYSLGTEqFeV7u31dya/wvXQwTwXmM0sQpUsutwr1KCCEZBsE46tZwxViPc4EQYiuwbbLS/fyj+N0rfvWaC+HY2cyUK8EHhFCtmJQKIRVSag4H2dawFlwL+xDxfj3fTtNdiECvJ3qTGKcFESpTmmm71Q5lHKO2jMqgtSWm0hKnu1VsaSNf1YVlrtSVMjdW6VEbXN/jhgF3EHjrm6oH0umRTy63VLwcsZeX2N0OOwx4F7AuNHXbD3r8KX8Bes/gW0VuxzcAAAAASUVORK5CYII=')",backgroundSize:"cover",display:"block"}}),"\n  ",(0,s.mdx)("img",{parentName:"a",className:"gatsby-resp-image-image",alt:'"Enable Kubernetes from Docker Desktop settings tab"',title:"Enable Kubernetes from Docker Desktop settings tab",src:"/static/14a53e933acb23fd2df6146cbf2df02b/a6d36/docker_desktop_kubernetes.png",srcSet:["/static/14a53e933acb23fd2df6146cbf2df02b/222b7/docker_desktop_kubernetes.png 163w","/static/14a53e933acb23fd2df6146cbf2df02b/ff46a/docker_desktop_kubernetes.png 325w","/static/14a53e933acb23fd2df6146cbf2df02b/a6d36/docker_desktop_kubernetes.png 650w","/static/14a53e933acb23fd2df6146cbf2df02b/e548f/docker_desktop_kubernetes.png 975w","/static/14a53e933acb23fd2df6146cbf2df02b/798d4/docker_desktop_kubernetes.png 976w"],sizes:"(max-width: 650px) 100vw, 650px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy",decoding:"async"}),"\n  "),"\n    "),"\n    ",(0,s.mdx)("figcaption",{parentName:"figure",className:"gatsby-resp-image-figcaption"},"Enable Kubernetes from Docker Desktop settings tab"),"\n  ")),(0,s.mdx)("p",null,"Execute ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"$ kubectl cluster-info")," to verify if Kubernetes cluster is running successfully. If not, uninstall and install ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Docker Desktop")," and ensure you receive the below message as expected to proceed with kubernetes deployment."),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"Verify if kubernetes is running"),(0,s.mdx)("div",{className:"gatsby-highlight","data-language":"bash"},(0,s.mdx)("pre",{parentName:"div",className:"language-bash"},(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"$  kubectl cluster-info\n\nKubernetes master is running at https://kubernetes.docker.internal:6443\nKubeDNS is running at https://kubernetes.docker.internal:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy"))),(0,s.mdx)("p",null,"To deploy docker images to kubernetes, we need to configure ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Deployment")," and ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Service")," objects and have them applied to orchestrate the deployment into kubernetes cluster."),(0,s.mdx)("p",null,"Deployment configuration files are created for services in ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"individual yaml")," file under ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"k8s")," folder."),(0,s.mdx)("p",null,(0,s.mdx)("figure",{parentName:"p",className:"gatsby-resp-image-figure",style:{}},"\n    ",(0,s.mdx)("span",{parentName:"figure",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"493px"}},"\n      ",(0,s.mdx)("a",{parentName:"span",className:"gatsby-resp-image-link",href:"/static/0222cc321bc07c663bb92aa2bf11353b/f88d0/k8s-yaml-files.png",style:{display:"block"},target:"_blank",rel:"noopener"},"\n    ",(0,s.mdx)("span",{parentName:"a",className:"gatsby-resp-image-background-image",style:{paddingBottom:"65.6441717791411%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAB30lEQVQ4y4WS/W6iUBDFfZFt1SqCgFzulygIKOA3mza7pdbVmE02+/5vcDb3Wlvb1faPyWES5sxv5k4tGAgMowhxkiCMIiRpimEUgvg+mOCgjKFrW3DczkuYcHvmWf4+alxYKEsfu90EVRViu03wcC9RlhRF0UUcNxBFLf2z7bwVKtNLUdtULfz9Q7DfCTzct7Fe1VGuG/heNlGu65jPG9j/usF4fIeOqciMq3SacPtsQvZtWDYB4xKMC1AuQXwKLiVsRyBNG5jP7mCYFtxe53PDTWVAyiaI7yLPRyjLGbIiQRxLLJYZKKMo8jqmxZHwS8Pdtq0Ne56LSaYMFyimY4ShwHKVw/MpZtM6FvMmjM4b4aX9acPFwsLvQwuHvYnDvoNNVcfjj294erxF9fNG6/PTLYQw0HXMT+m0oU89MO4hGvWxXBXIixTpOMRgyF9JbOcY5yRXDSlz4JEuuCAYxQH6AdO57Rgvxce9fdzd1bOhzIVPHU0ZDDjiZKDpiG+ja7e/HPECoauLPWJBfSs6RRmNAsi+j55n6VDdlR4P/P9bfH0UZaYIlXLhaVUFhDoIBgxxEuq9ZnmsVUiim34c+5TX1IiqszJivKf1RHEiUaTq0ZI0xCSLIYR3tuP3hP8AOFicMxvbFEwAAAAASUVORK5CYII=')",backgroundSize:"cover",display:"block"}}),"\n  ",(0,s.mdx)("img",{parentName:"a",className:"gatsby-resp-image-image",alt:'"K8s configuration files"',title:"K8s configuration files",src:"/static/0222cc321bc07c663bb92aa2bf11353b/f88d0/k8s-yaml-files.png",srcSet:["/static/0222cc321bc07c663bb92aa2bf11353b/222b7/k8s-yaml-files.png 163w","/static/0222cc321bc07c663bb92aa2bf11353b/ff46a/k8s-yaml-files.png 325w","/static/0222cc321bc07c663bb92aa2bf11353b/f88d0/k8s-yaml-files.png 493w"],sizes:"(max-width: 493px) 100vw, 493px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy",decoding:"async"}),"\n  "),"\n    "),"\n    ",(0,s.mdx)("figcaption",{parentName:"figure",className:"gatsby-resp-image-figcaption"},"K8s configuration files"),"\n  ")),(0,s.mdx)("p",null,"Below is the sample deployment & service configuration for ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Consul")," to deploy to kubernetes. Service type is configured as ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"NodePort"),", such that it is available to access Consul UI using the host address on configured port i.e ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"32500"),"."),(0,s.mdx)("div",{className:"gatsby-highlight","data-language":"yaml"},(0,s.mdx)("pre",{parentName:"div",className:"language-yaml"},(0,s.mdx)("code",{parentName:"pre",className:"language-yaml"},(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"apiVersion"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," apps/v1\n",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"kind"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," Deployment\n",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"metadata"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n  ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"name"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," consul",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"server\n",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"spec"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n  ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"replicas"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," ",(0,s.mdx)("span",{parentName:"code",className:"token number"},"1"),"\n  ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"selector"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"matchLabels"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n      ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"app"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," consul",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"server\n  ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"template"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"metadata"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n      ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"labels"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n        ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"app"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," consul",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"server\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"spec"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n      ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"containers"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n        ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-")," ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"name"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," consul",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"server\n          ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"image"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," consul\n          ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"ports"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n            ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-")," ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"containerPort"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," ",(0,s.mdx)("span",{parentName:"code",className:"token number"},"8500"),"\n          ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"imagePullPolicy"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," Always\n          ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"env"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n            ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-")," ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"name"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," CONSUL_BIND_INTERFACE\n              ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"value"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," ",(0,s.mdx)("span",{parentName:"code",className:"token string"},'"eth0"'),"\n",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"---"),"\n",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"apiVersion"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," v1\n",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"kind"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," Service\n",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"metadata"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n  ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"name"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," consul",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"server",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"svc\n",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"spec"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n  ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"selector"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"app"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," consul",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"server\n  ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"ports"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n    ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-")," ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"port"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," ",(0,s.mdx)("span",{parentName:"code",className:"token number"},"8500"),"\n      ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"targetPort"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," ",(0,s.mdx)("span",{parentName:"code",className:"token number"},"8500"),"\n      ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"nodePort"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," ",(0,s.mdx)("span",{parentName:"code",className:"token number"},"32500"),"\n  ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"type"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," NodePort"))),(0,s.mdx)("p",null,"Below is the sample deployment & service configuration for ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Service A")," to deploy to kubernetes."),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"service-a.yaml"),(0,s.mdx)("div",{className:"gatsby-highlight has-highlighted-lines","data-language":"yaml"},(0,s.mdx)("pre",{parentName:"div",className:"language-yaml"},(0,s.mdx)("code",{parentName:"pre",className:"language-yaml"},(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"apiVersion"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," apps/v1\n",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"kind"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," Deployment\n",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"metadata"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n  ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"name"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," springboot",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"service",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"a\n",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"spec"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n  ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"replicas"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," ",(0,s.mdx)("span",{parentName:"code",className:"token number"},"1"),"\n  ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"selector"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"matchLabels"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n      ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"app"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," springboot",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"service",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"a\n  ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"template"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"metadata"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n      ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"labels"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n        ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"app"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," springboot",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"service",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"a\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"spec"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n      ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"containers"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n        ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-")," ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"name"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," app\n          ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"image"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," $DOCKER_USER_NAME$/spring",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"multi",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"module",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"consul",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"service",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"a\n          ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"ports"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n            ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-")," ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"containerPort"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," ",(0,s.mdx)("span",{parentName:"code",className:"token number"},"8080"),"\n          ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"imagePullPolicy"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," Always\n          ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"env"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n",(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"            ",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"-")," ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"name"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")," spring.profiles.active"),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"              ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"value"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")," ",(0,s.mdx)("span",{parentName:"span",className:"token string"},'"prod"')),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"            ",(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},"-")," ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"name"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")," spring.cloud.consul.host"),(0,s.mdx)("span",{parentName:"code",className:"gatsby-highlight-code-line"},"              ",(0,s.mdx)("span",{parentName:"span",className:"token key atrule"},"value"),(0,s.mdx)("span",{parentName:"span",className:"token punctuation"},":")," ",(0,s.mdx)("span",{parentName:"span",className:"token string"},'"$(CONSUL_SERVER_SVC_SERVICE_HOST)"')),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"---"),"\n",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"apiVersion"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," v1\n",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"kind"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," Service\n",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"metadata"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n  ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"name"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," springboot",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"service",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"a",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"svc\n",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"spec"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n  ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"selector"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n    ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"app"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," springboot",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"service",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-"),"a\n  ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"ports"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":"),"\n    ",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"-")," ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"port"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," ",(0,s.mdx)("span",{parentName:"code",className:"token number"},"8080"),"\n      ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"targetPort"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," ",(0,s.mdx)("span",{parentName:"code",className:"token number"},"8080"),"\n  ",(0,s.mdx)("span",{parentName:"code",className:"token key atrule"},"type"),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},":")," LoadBalancer"))),(0,s.mdx)("p",null,"As observed, ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Service A")," deployment is configured with environment variables to set ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"spring.profiles.active")," to ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"prod"),". "),(0,s.mdx)("p",null,"We need to pass ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"spring.cloud.consul.host")," as ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"consul")," will be not be accessible via ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"localhost")," or ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"127.0.0.1"),". For this to work, we need to configure the environment variable that are created when services are created. One of them is ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"CONSUL_SERVER_SVC_SERVICE_HOST"),"."),(0,s.mdx)("p",null,"Passing ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"$(CONSUL_SERVER_SVC_SERVICE_HOST)")," will expand the environment variable with host of ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Consul"),"."),(0,s.mdx)("p",null,"Run the below ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"kubectl")," commands to deploy or delete the stack."),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"Apply deployments and services"),(0,s.mdx)("div",{className:"gatsby-highlight","data-language":"bash"},(0,s.mdx)("pre",{parentName:"div",className:"language-bash"},(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"$ kubectl apply -f k8s"))),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"List deployments, services and pods after applying the change"),(0,s.mdx)("div",{className:"gatsby-highlight","data-language":"bash"},(0,s.mdx)("pre",{parentName:"div",className:"language-bash"},(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"$ kubectl get all"))),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"Watch pods by getting all pods or for a specific app"),(0,s.mdx)("div",{className:"gatsby-highlight","data-language":"bash"},(0,s.mdx)("pre",{parentName:"div",className:"language-bash"},(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"$ kubectl get pods --watch\n\n$ kubectl get pods -l ",(0,s.mdx)("span",{parentName:"code",className:"token assign-left variable"},"app"),(0,s.mdx)("span",{parentName:"code",className:"token operator"},"="),"springboot-service-a --watch"))),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"Get Environment Variables set to the pod"),(0,s.mdx)("div",{className:"gatsby-highlight","data-language":"bash"},(0,s.mdx)("pre",{parentName:"div",className:"language-bash"},(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"$ kubectl ",(0,s.mdx)("span",{parentName:"code",className:"token builtin class-name"},"exec")," ",(0,s.mdx)("span",{parentName:"code",className:"token operator"},"<"),"POD_NAME",(0,s.mdx)("span",{parentName:"code",className:"token operator"},">")," -- ",(0,s.mdx)("span",{parentName:"code",className:"token function"},"printenv")," ",(0,s.mdx)("span",{parentName:"code",className:"token operator"},"|")," ",(0,s.mdx)("span",{parentName:"code",className:"token function"},"grep")," SERVICE"))),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"Dump pod logs"),(0,s.mdx)("div",{className:"gatsby-highlight","data-language":"bash"},(0,s.mdx)("pre",{parentName:"div",className:"language-bash"},(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"$ kubectl logs ",(0,s.mdx)("span",{parentName:"code",className:"token operator"},"<"),"POD_NAME",(0,s.mdx)("span",{parentName:"code",className:"token operator"},">"),"\n\n$ kubectl logs -f ",(0,s.mdx)("span",{parentName:"code",className:"token operator"},"<"),"POD_NAME",(0,s.mdx)("span",{parentName:"code",className:"token operator"},">")))),(0,s.mdx)("p",null,"Access Consul UI using ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"http://localhost:32500")," after a minute to observe ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"three services")," registered along side with ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"consul")," service."),(0,s.mdx)("p",null,"Run the below command to scale up ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Service B")," and ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Service C"),". Access Consul UI and observe if the no of instances for ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Service B")," & ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Service C")," are displayed as ",(0,s.mdx)("strong",{parentName:"p"},"3")," instead of ",(0,s.mdx)("strong",{parentName:"p"},"1"),"."),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"Scale deployment up/down by setting replicas"),(0,s.mdx)("div",{className:"gatsby-highlight","data-language":"bash"},(0,s.mdx)("pre",{parentName:"div",className:"language-bash"},(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"$ kubectl scale --replicas",(0,s.mdx)("span",{parentName:"code",className:"token operator"},"="),(0,s.mdx)("span",{parentName:"code",className:"token number"},"3")," deployment/springboot-service-b\n\n$ kubectl scale --replicas",(0,s.mdx)("span",{parentName:"code",className:"token operator"},"="),(0,s.mdx)("span",{parentName:"code",className:"token number"},"3")," deployment/springboot-service-c"))),(0,s.mdx)("p",null,(0,s.mdx)("figure",{parentName:"p",className:"gatsby-resp-image-figure",style:{}},"\n    ",(0,s.mdx)("span",{parentName:"figure",className:"gatsby-resp-image-wrapper",style:{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",maxWidth:"299px"}},"\n      ",(0,s.mdx)("a",{parentName:"span",className:"gatsby-resp-image-link",href:"/static/96cc23c93531f878529e6613d63f8c2f/aeb78/consul-ui-services-k8s.png",style:{display:"block"},target:"_blank",rel:"noopener"},"\n    ",(0,s.mdx)("span",{parentName:"a",className:"gatsby-resp-image-background-image",style:{paddingBottom:"138.03680981595093%",position:"relative",bottom:"0",left:"0",backgroundImage:"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAIAAADuuAg3AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAC/0lEQVQ4y6WTy27TQBiF/R6IDYg1UJ4AJCReABCIHZc9CLFnwRsgFqWiVWlB5SLaQhEbQBSapI3tNrVJbNe5+JbYju8ejx3fBrlZoNImbcXR0azmm1/nzAz2/tKDdxfvvzh1Y/r0zeMa+3Lrycr1x9Nnbj0/cXXq5LWpk8P1SMY+XHn0/vLD2bO35ybuzp2/M1xfnrszP3F3/sK9v5649+rCv8Z8qT/QnNyBiQkSC8Sml1ggdyDU7KBnQtUKVAuqZqiaoPevMQCDxZVPFbxa51h8a/NnucS1mhW8ajtOjtAgSzOUOSESbLRfGIRwcXF5cnLq29fvH5c/vVl4u7S0PDMzy7Kc63odQZYkyXQTnEdhlKM8z7O/xtAI5UMhVHh3734VsBlas/xrzdJFQRRFUVEU13X3HnTwgAL2Y7Cql3RTb9TrDNNgGCYAwXA4GqsCztIsDCLDsD0fAAAPZfbCeRYniQ+AX8BBHCdFoPxwYShHWZ7HWbz/4GxPtQe4mNwPjafspKhK9DbFN3mapkVR7Ov6obELeJAOOkC0bEvoCKZpyrKsqqplWUfKnKYZAFDrm7brWY53vMLSOM6iOAqCEIAoAIMgiMMwDsMkirI0HZc5MQzhx3dy7bO2SRq1mk6S/a0tnSRVglCrVbVSKZKP6B5LFJVjiWfSLC821zeqDY7FSfI3w3A8jxDSCSIbnQKLFMVstyFKPQBs1wUQ+kEQxXGcpsVF1Gpj4W63R1GGpos7TVWQpGbbN8w8DBMAYtfVcHxMe1gKfPVXya2QWrmslSu7a7m7Vuqurck/VrtVPE2SbIQwsMO3ycrKxoLSoBWKlilKoWmdZQ2OcwTB2N42GWbUz8J8jpd7rQV1qSW11jeqLL9TxXGG4yzHQQglrtuv10fCDssC08py5AUhiAZBNEh2qxruTn1/3GSn0egRhMowbYIUN2ttgtQZxu90vFbbFyWbojWKGgknEDqC6Mmyryi+rPiK4kqyI0pD24IAveLBHlwY+g9hh/z33Yc5Cv4DizrVy/Mq38AAAAAASUVORK5CYII=')",backgroundSize:"cover",display:"block"}}),"\n  ",(0,s.mdx)("img",{parentName:"a",className:"gatsby-resp-image-image",alt:"Instances registered after scaling up services",title:"Instances registered after scaling up services",src:"/static/96cc23c93531f878529e6613d63f8c2f/aeb78/consul-ui-services-k8s.png",srcSet:["/static/96cc23c93531f878529e6613d63f8c2f/222b7/consul-ui-services-k8s.png 163w","/static/96cc23c93531f878529e6613d63f8c2f/aeb78/consul-ui-services-k8s.png 299w"],sizes:"(max-width: 299px) 100vw, 299px",style:{width:"100%",height:"100%",margin:"0",verticalAlign:"middle",position:"absolute",top:"0",left:"0"},loading:"lazy",decoding:"async"}),"\n  "),"\n    "),"\n    ",(0,s.mdx)("figcaption",{parentName:"figure",className:"gatsby-resp-image-figcaption"},"Instances registered after scaling up services"),"\n  ")),(0,s.mdx)("p",null,"Access ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Service A")," greeting endpoint by invoking the request to service running on port ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"8080")," to see if API is working as expected by successfully accessing downstream APIs."),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"Access service-a greeting endpoint"),(0,s.mdx)("div",{className:"gatsby-highlight","data-language":"bash"},(0,s.mdx)("pre",{parentName:"div",className:"language-bash"},(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"$ ",(0,s.mdx)("span",{parentName:"code",className:"token function"},"curl")," http://localhost:8080/greeting\n\n",(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"{"),(0,s.mdx)("span",{parentName:"code",className:"token string"},'"id"'),":1,",(0,s.mdx)("span",{parentName:"code",className:"token string"},'"content"'),(0,s.mdx)("span",{parentName:"code",className:"token builtin class-name"},":"),(0,s.mdx)("span",{parentName:"code",className:"token string"},'"Service-A - Hello, World! - Service-B - Hello, World! - 1 - Service-C - Hello, World! - 1"'),(0,s.mdx)("span",{parentName:"code",className:"token punctuation"},"}")))),(0,s.mdx)("p",null,"Bring down the stack after testing the services."),(0,s.mdx)("div",{className:"gatsby-code-title gatsby-remark-code-title"},"Delete pods and services"),(0,s.mdx)("div",{className:"gatsby-highlight","data-language":"bash"},(0,s.mdx)("pre",{parentName:"div",className:"language-bash"},(0,s.mdx)("code",{parentName:"pre",className:"language-bash"},"$ kubectl delete -f k8s"))),(0,s.mdx)("h2",{id:"why-do-we-need-consul-on-kubernetes-"},"Why do we need Consul on Kubernetes ?"),(0,s.mdx)("p",null,"For the purpose of this article, we are successful with provisioning ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Consul")," and leveraging the concepts of ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Service Registration and Discovery")," on ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Kubernetes"),"."),(0,s.mdx)("p",null,"But, Kubernetes already has built in support for Service Discovery pattern. So why do we need Consul on Kubernetes ?"),(0,s.mdx)("p",null,"This could be for multiple reasons which needs better understanding on what can/cannot be achieved with kubernetes. Dig into this ",(0,s.mdx)(r,{href:"https://qr.ae/pNJlog",mdxType:"ExternalLink"},"answer")," on Quora which lists the possible cases why ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Consul")," might be needed compared to the default capabilities provided by ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Kubernetes"),"."),(0,s.mdx)("h2",{id:"conclusion"},"Conclusion"),(0,s.mdx)("p",null,"This article is an extension to my ",(0,s.mdx)(r,{href:"https://2much2learn.com/mavengradle-based-multi-module-spring-boot-microservices/",mdxType:"ExternalLink"},"previous article")," on implementing usecases to try out different microservice concepts and patterns."),(0,s.mdx)("p",null,"This article is useful for usecase which needs all the services registered and integrated with Consul. With the support of configuring multiple modules with Maven and Gradle, it is easy for one to build all the modules with single command and have the stack deployed seamlessly to ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"docker-compose")," and ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"kubernetes"),"."),(0,s.mdx)("p",null,"We just digged into ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Service Discovery")," capability under ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"spring-cloud-consul"),". This article shall be the base for trying out microservice pattern - ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"Centralized Configuration")," with ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"spring-cloud-consul"),"."),(0,s.mdx)("p",null,"Apart from the above, ",(0,s.mdx)("code",{parentName:"p",className:"language-text"},"spring-cloud")," provides lot other capabilities and this article codebase will be extended to try out some of the below."),(0,s.mdx)("ul",null,(0,s.mdx)("li",{parentName:"ul"},"Distributed Tracing"),(0,s.mdx)("li",{parentName:"ul"},"Fault Tolerance"),(0,s.mdx)("li",{parentName:"ul"},"API Gateway"),(0,s.mdx)("li",{parentName:"ul"},"And many more…")),(0,s.mdx)(p,{href:"https://github.com/2much2learn/article_jan_03_srv-reg-and-discvry-in-spring-boot-microservices-with-spring-cloud-consul",mdxType:"GithubRepo"},"srv-reg-and-discvry-in-spring-boot-microservices-with-spring-cloud-consul"))}d.isMDXComponent=!0},63366:function(e,a,n){function t(e,a){if(null==e)return{};var n,t,s={},m=Object.keys(e);for(t=0;t<m.length;t++)n=m[t],a.indexOf(n)>=0||(s[n]=e[n]);return s}n.d(a,{Z:function(){return t}})}}]);
//# sourceMappingURL=component---src-pages-content-articles-microservice-service-registration-and-discovery-in-spring-boot-microservices-with-spring-cloud-consul-index-md-c0cf088a6a5ea03cf44b.js.map